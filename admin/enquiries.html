<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer Enquiries | Fabrication Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #f4f4f4;
      font-family: "Segoe UI", sans-serif;
    }

    /* NAVBAR */
    .admin-navbar {
      background: #111;
      border-bottom: 3px solid #f7941d;
    }

    .admin-navbar .navbar-brand {
      font-weight: 700;
      color: #f7941d !important;
      letter-spacing: 1px;
    }

    /* PAGE TITLE */
    .page-title {
      font-weight: 800;
      color: #222;
    }

    /* TABLE */
    .table thead {
      background: #111;
      color: #fff;
    }

    .table th, .table td {
      vertical-align: middle;
    }

    .badge-interest {
      background: #f7941d;
      color: #111;
      font-weight: 600;
    }

    /* BUTTONS */
    .btn-delete {
      background: #c0392b;
      border: none;
    }

    .btn-delete:hover {
      background: #a93226;
    }

    /* CARD */
    .card {
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    /* MOBILE */
    @media (max-width: 768px) {
      .table {
        font-size: 14px;
      }
    }
  </style>
</head>

<body>

<script>
  if (!localStorage.getItem("adminToken")) {
    location.href = "login.html";
  }
</script>

<!-- ================= NAVBAR ================= -->
<nav class="navbar admin-navbar px-4">
  <span class="navbar-brand">FABRICATION ADMIN</span>
  <a href="dashboard.html" class="btn btn-warning fw-semibold">Dashboard</a>
</nav>

<!-- ================= CONTENT ================= -->
<div class="container mt-5">

  <h3 class="page-title mb-4">ðŸ“© Customer Enquiries</h3>

  <div class="card p-3">
    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead>
          <tr>
            <th>Name</th>
            <th>Phone</th>
            <th>Interest</th>
            <th style="width:120px;">Action</th>
          </tr>
        </thead>
        <tbody id="list"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ================= JS ================= -->
<script>
const API_BASE = "https://fabrication-backend.onrender.com";

// GET enquiries
fetch(`${API_BASE}/api/enquiries`, {
  headers: {
    Authorization: `Bearer ${localStorage.getItem("adminToken")}`
  }
})
.then(res => res.json())
.then(data => {
  list.innerHTML = data.map(e => `
    <tr>
      <td>${e.name}</td>
      <td>${e.phone}</td>
      <td>
        <span class="badge badge-interest">
          ${e.interest || "General"}
        </span>
      </td>
      <td>
        <button class="btn btn-delete btn-sm text-white"
          onclick="del('${e._id}')">
          Delete
        </button>
      </td>
    </tr>
  `).join("");
})
.catch(err => {
  alert("Failed to load enquiries");
  console.error(err);
});

// DELETE enquiry
function del(id) {
  if (!confirm("Are you sure you want to delete this enquiry?")) return;

  fetch(`${API_BASE}/api/enquiries/${id}`, {
    method: "DELETE",
    headers: {
      Authorization: `Bearer ${localStorage.getItem("adminToken")}`
    }
  }).then(() => location.reload());
}
</script>

</body>
</html>
